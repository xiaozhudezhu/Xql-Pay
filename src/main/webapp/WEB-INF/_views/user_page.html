<html>
<head>
<meta charset="utf-8">
<meta
	content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no"
	name="viewport">
<meta content="yes" name="apple-mobile-web-app-capable">
<meta content="black" name="apple-mobile-web-app-status-bar-style">
<meta content="telephone=no" name="format-detection">
<meta content="email=no" name="format-detection">
<!-- 引入bootstrap样式 -->
<link
	href="https://cdn.bootcss.com/bootstrap/3.3.6/css/bootstrap.min.css"
	rel="stylesheet">
<link href="static/js/bootstrap/switch/bootstrapSwitch.css"
	rel="stylesheet">
<link href="static/js/bootstrap/cityPicker/city-picker.css"
	rel="stylesheet">
<!-- 引入bootstrap-table样式 -->
<link
	href="https://cdn.bootcss.com/bootstrap-table/1.11.1/bootstrap-table.min.css"
	rel="stylesheet">
<link rel="stylesheet" href="http://cdn.bootcss.com/weui/1.1.1/style/weui.min.css">
<link rel="stylesheet" href="http://cdn.bootcss.com/jquery-weui/1.0.1/css/jquery-weui.min.css">
<style>
.city-picker-dropdown {
	left: 15px !important;
}
</style>

<title>个人主页</title>
</head>
<body ontouchstart class="">
	<ul class="nav nav-tabs" id="tabs" role="tablist" style="z-index: 100;background: white;width: 100%;position: fixed;">
		<li role="presentation" class="active"><a href="#userInfo"
			aria-controls="userInfo" role="tab" data-toggle="tab">个人信息</a></li>
		<li role="presentation"><a href="#paySelect"
			aria-controls="paySelect" role="tab" data-toggle="tab" onclick="return paySelect();">购买产品</a></li>
		<li role="presentation"><a href="#payRecord"
			aria-controls="payRecord" role="tab" data-toggle="tab">付款记录</a></li>
		<!-- <li role="presentation"><a href="#myClass"
			aria-controls="myClass" role="tab" data-toggle="tab">我的课程</a></li> -->
	</ul>
	<div class="tab-content" style="padding-top: 50px;">
		<div role="tabpanel" class="tab-pane active" id="userInfo">
			<form class="form-horizontal">
				<input type="hidden" name="userid" />
				<div style="max-width: 800px; margin: auto; padding: 20px;">
					<h4 id="registerInfoTitle" style="display: none;">请完善您的会员资料<hr></h4>
					<div class="form-group">
						<div class="col-sm-2 control-label" style="text-align: left;width: 20%;padding: 0px 0px 0px 10px;display: inline-block;float: left;">
							<img class="img-thumbnail" id="userInfo_headImg" width="80"
								height="80"></img>
						</div>
						<div class="col-sm-8" style="display: inline-block;width:50%;float: left;">
							<input class="form-control"
								style="margin-top: 20px; font-size: 20px; border: 0; box-shadow: none;" id="userInfo_name" name="name" />
						</div>
						<div class="col-sm-2" style="display: inline-block;width:30%;">
							<button class="pull-right btn btn-success" style="margin-top: 20px;vertical-align:unset;" onclick="saveCurrentUser();return false;">保存</button>
						</div>
						
					</div>
					<hr />
					<div class="form-group">
						<p class="col-sm-2 control-label" style="text-align: left;">邮件地址</p>
						<div class="col-sm-10">
							<input type="email" class="form-control" id="userInfo_id" name="id"></input>
						</div>
					</div>
					<div class="form-group">
						<p class="col-sm-2 control-label" style="text-align: left;">球龄</p>
						<div class="col-sm-10">
							<input type="number" class="form-control" id="userInfo_yearsplay" name="yearsplay"></input>
						</div>
					</div>
					<div class="form-group">
						<p class="col-sm-2 control-label" style="text-align: left;">性别</p>
						<div class="col-sm-10">
							<div class="switch" style="height: 34px;" data-on="success"
								data-off="warning" data-on-label="男" data-off-label="女">
								<input type="checkbox" id="userInfo_gender" checked />
							</div>
						</div>
					</div>
					<div class="form-group">
						<p class="col-sm-2 control-label" style="text-align: left;">年龄层</p>
						<div class="col-sm-10">
							<select class="form-control" name="age" id="userInfo_age">
								<option value="">请选择</option>
								<option value="1">20-29</option>
								<option value="2">30-39</option>
								<option value="3">40-49</option>
								<option value="4">50-59</option>
								<option value="5">60-69</option>
								<option value="6">70+</option>
							</select>
						</div>
					</div>
					<div class="form-group">
						<p class="col-sm-2 control-label" style="text-align: left;">目前等级自测</p>
						<div class="col-sm-10">
							<select class="form-control" name="level" id="userInfo_level">
								<option value="">请选择</option>
								<option value="1">初级（2.5以下）</option>
								<option value="2">中级（2.5-4.0）</option>
								<option value="3">高级（4.0以上）</option>
							</select>
						</div>
					</div>
					<div class="form-group">
						<p class="col-sm-2 control-label" style="text-align: left;">每月练球时长</p>
						<div class="col-sm-10">
							<select class="form-control" name="hourspractice" id="userInfo_hourspractice">
								<option value="">请选择</option>
								<option value="1">2</option>
								<option value="2">4</option>
								<option value="3">6</option>
								<option value="4">8</option>
								<option value="5">10</option>
								<option value="6">12</option>
								<option value="7">16</option>
								<option value="8">20+</option>
							</select>
						</div>
					</div>
					<div class="form-group">
						<p class="col-sm-2 control-label" style="text-align: left;">期望达到水平</p>
						<div class="col-sm-10">
							<select class="form-control" name="achivinglevel" id="userInfo_achivinglevel">
								<option value="">请选择</option>
         						<option value="2">中级</option>
         						<option value="3">高级</option>
         						<option value="4">高级5.0以上</option>
							</select>
						</div>
					</div>
					<div class="form-group">
						<p class="col-sm-2 control-label" style="text-align: left;">地区</p>
						<div class="col-sm-10">
							<input class="form-control" readonly id="userInfo_city" name="city"></input>
						</div>
					</div>
				</div>
			</form>

		</div>
		<div role="tabpanel" class="tab-pane" id="myClass">...</div>
		<div role="tabpanel" class="tab-pane" id="payRecord">
			<iframe src="payRecord"
				style="width: 100%; height: calc(100% - 50px); border: 0; padding: 5px;"></iframe>
		</div>
		<div role="tabpanel" class="tab-pane" id="paySelect">
			<iframe src="paySelect"
				style="width: 100%; height: calc(100% - 50px); border: 0; padding: 5px;"></iframe>
		</div>
	</div>
</body>
<script src="https://cdn.bootcss.com/jquery/1.11.0/jquery.min.js"></script>
<script
		src="http://cdn.bootcss.com/jquery-weui/1.0.1/js/jquery-weui.min.js"></script>
<script
	src="https://cdn.bootcss.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>

<!-- bootstrap-table.min.js -->
<script
	src="https://cdn.bootcss.com/bootstrap-table/1.12.1/bootstrap-table.min.js"></script>
<!-- 引入中文语言包 -->
<script
	src="https://cdn.bootcss.com/bootstrap-table/1.12.1/locale/bootstrap-table-zh-CN.min.js"></script>
<script src="static/js/bootstrap/switch/bootstrapSwitch.js"></script>
<script src="static/js/bootstrap/cityPicker/city-picker.data.js"></script>
<script src="static/js/bootstrap/cityPicker/city-picker.js"></script>
<script src="static/layer/layer.js"></script>
<script type="text/javascript">
	$.get('userPage/getCurrentUser', {}, function(userInfo) {
		$('#userInfo_headImg').attr('src', userInfo.headimgurl);
		$('#userInfo_name').html(userInfo.name);
		$('#userInfo :input').each(function(i, input) {
			$(input).val(userInfo[$(input).attr('name')]);
		});
		$('#userInfo_gender').attr('checked', userInfo.gender == 'm' ? true : false);
		$('#userInfo_gender').change();
		//$('#userInfo_gender').bootstrapSwitch('setState', true);
		$('#userInfo_city').val(userInfo.city).citypicker();

	});
	
	function saveCurrentUser() {
		var userInfo = {};
		$('#userInfo :input').each(function(i, input) {
			userInfo[$(input).attr('name')] = $(input).val();
		});
		userInfo.gender = $('#userInfo_gender').prop('checked') ? 'm' : 'f';
		$.showLoading("正在提交...");
		$.post('/userPage/saveCurrentUser', userInfo, function(res) {
			$.hideLoading();
			if(res.status == 'success') {
				var redirect = getQueryString('redirect');
				if(!redirect)
					layer.alert('保存成功');
				else if(res.member.userstatus == 'N')
					layer.alert('请完整填写您的会员资料');
				else 
					layer.alert('保存成功', function() {
						top.postMessage({ type: 'redirect', url: redirect}, '*');
					});
			}
			else {
				layer.alert('保存失败');
			}
		});
	}
	
	if(location.hash) {
		$('#tabs a[href="' + location.hash + '"]').tab('show')
	}
	
	function paySelect() {
		var ua = window.navigator.userAgent.toLowerCase();
		if (ua.match(/MicroMessenger/i) == 'micromessenger') {
			top.postMessage({ type: 'redirect', url: 'http://pay.xueqiule.com/paySelect'}, '*');
			return false;
		}
	}
	
	function getQueryString(name) { 
		var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i"); 
		var r = window.location.search.substr(1).match(reg); 
		if (r != null) return unescape(r[2]); return null; 
	} 
	
	var redirect = getQueryString('redirect');
	if(redirect) {
		$('#registerInfoTitle').show();
	}
	
		
</script>
</html>